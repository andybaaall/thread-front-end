let serverURL,serverPort,url,id,editing=!1;$(document).ready(()=>{$.ajax({url:"config.json",type:"GET",dataType:"json",success:function(e){serverURL=e.SERVER_URL,serverPort=e.SERVER_PORT,url=`${e.SERVER_URL}:${e.SERVER_PORT}`,showItems()},error:function(e){console.log("Sorry, but we couldn't find a config.json!")}}),sessionStorage.userName?(hideRegisterBtn(),hideLoginBtn(),showLogoutBtn(),showAddItemForm()):(showRegisterBtn(),showLoginBtn(),hideLogoutBtn(),hideAddItemForm())}),showItems=(()=>{$.ajax({url:`${url}/allItems`,type:"GET",dataType:"json",success:function(e){console.log("got all items"),console.log(e),$("#cardContainer").find(".row").empty();for(var o=0;o<e.length;o++){let t=`\n                <div class="col-12 col-md-4">\n                <div class="card" data-id="${e[o]._id}">\n                <div class="card-body">\n                <div id="worktitle" class="card-title">\n                <div class="cardImg" style="background-image: url(${url}/${e[o].image_URL}); height: 200px; width: 100%; background-size: contain;background-repeat: no-repeat;background-position: top;" >\n                </div>\n                <h5 class="card-title text-center mt-3" >${e[o].item_name}</h5>\n                <p class="text-center">$ ${e[o].price}</p>`;1==e[o].bought&&(t+='<p class="text-center">Sold out</p>'),t+="</div>",sessionStorage.userID===e[o].user_id&&(t+='<div class="btnSet d-flex justify-content-center">\n                    <button class="btn btn-warning btn-sm mr-1 editBtn">EDIT</button>\n                    <button class="btn btn-danger btn-sm removeBtn">REMOVE</button>\n                    </div>'),t+='<div class="btnSet d-flex justify-content-center">\n                <button class="btn btn-secondary btn-sm mr-1 moreInfoBtn" data-toggle="modal" data-target="#singleItemModal">MORE INFO</button>',sessionStorage.userID&&0==e[o].bought&&(t+='<button class="btn btn-success btn-sm mr-1 buyBtn" data-toggle="modal" data-target="#buyModal">BUY</button>'),t+="</div>\n                </div>\n                </div>\n                </div>",$("#cardContainer").find(".row").append(t)}$("#cardContainer").removeClass("d-none")},error:function(e){console.log(e),console.log("How embarassing, a database error! This never usually happens to me.")}})});const clearForms=()=>{$(".form-control").val(""),$("#itemUsed").prop("checked",!0),$("#itemTops").prop("checked",!0)},showLoginBtn=()=>{$("#loginBtn").removeClass("d-none")},showLogoutBtn=()=>{$("#logoutBtn").removeClass("d-none")},showRegisterBtn=()=>{$("#registerBtn").removeClass("d-none")},showLoginForm=()=>{$("#userForm").removeClass("d-none"),$("#loginFormBox").removeClass("d-none")},showRegisterForm=()=>{$("#userForm").removeClass("d-none"),$("#registerFormBox").removeClass("d-none")},showAddItemForm=()=>{$("#addItemForm").show()},showEditItemForm=()=>{$("#editModal").modal("show")},hideLoginBtn=()=>{$("#loginBtn").addClass("d-none")},hideLogoutBtn=()=>{$("#logoutBtn").addClass("d-none")},hideRegisterBtn=()=>{$("#registerBtn").addClass("d-none")},hideLoginForm=()=>{$("#userForm").addClass("d-none"),$("#loginFormBox").addClass("d-none")},hideRegisterForm=()=>{$("#userForm").addClass("d-none"),$("#registerFormBox").addClass("d-none")},hideAddItemForm=()=>{$("#addItemForm").hide()},hideEditItemForm=()=>{$("#editModal").addClass("d-none")};$("#loginBtn").click(()=>{$(".main").addClass("d-none"),$("#lUsername").val(null),$("#lPassword").val(null),$("#userForm").removeClass("d-none"),$("#loginFormBox").removeClass("d-none"),$("#registerFormBox").addClass("d-none"),$("#errLogin").empty()}),$("#logoutBtn").click(()=>{hideLogoutBtn(),hideAddItemForm(),showRegisterBtn(),showLoginBtn(),$("#cardContainer").addClass("d-none"),showItems(),sessionStorage.clear()}),$("#registerBtn").click(()=>{$(".main").addClass("d-none"),$("#rUsername").val(null),$("#rEmail").val(null),$("#rPassword").val(null),$("#rConfirmPassword").val(null),$("#errLogin").empty(),hideLoginForm(),$("#userForm").removeClass("d-none"),$("#registerFormBox").removeClass("d-none")}),$("#loginForm").submit(()=>{if(event.preventDefault(),sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");const e=$("#lUsername").val(),o=$("#lPassword").val();0===e.length||0===o.length?alert("Please enter your username and password!"):$.ajax({url:`${url}/getUser`,type:"POST",data:{username:e,password:o},success:function(e){"user does not exist"===e?($("#errLogin").empty(),$("#errLogin").append('<p class="text-danger">Sorry, user does not exist. </p>')):"invalid password"===e?alert("Oh dear, it looks like you've entered the wrong password."):sessionStorage.username?console.log("401 error: you don't have permission to be here. Sorry. We don't make the rules."):(sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userName",e.username),sessionStorage.setItem("userEmail",e.email),hideRegisterBtn(),hideLoginBtn(),showLogoutBtn(),$("#userForm").addClass("d-none"),$(".main").removeClass("d-none"),$("#addListBtn").removeClass("d-none"),showItems(),showAddItemForm(),$("#errLogin").empty())},error:function(e){console.log(e),console.log("How embarassing, a database error! This never usually happens to me.")}})}),$("#registerForm").submit(()=>{if(event.preventDefault(),sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");const e=$("#rUsername").val(),o=$("#rEmail").val(),t=$("#rPassword").val(),n=$("#rConfirmPassword").val();return 0==e.length?(alert("Please enter a username!"),void showItems()):0==o.length?(alert("Please enter an email address!"),void showItems()):0==t.length?(alert("Please enter a password!"),void showItems()):0==n.length?(alert("Please confirm your password!"),void showItems()):t!==n?(alert("One of those passwords is not like the other!"),void showItems()):void $.ajax({url:`${url}/users`,type:"POST",data:{username:e,email:o,password:t},success:function(e){console.log(e),"Invalid user"===e?(alert("Sorry, this username is taken."),console.log(sessionStorage),showItems()):(sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userName",e.username),sessionStorage.setItem("userEmail",e.email),$(".main").removeClass("d-none"),hideRegisterForm(),hideRegisterBtn(),hideLoginBtn(),showItems(),showLogoutBtn(),showAddItemForm())},error:function(e){console.log(e),console.log("How embarassing, a database error! This never usually happens to me.")}})}),$("#addItemForm").on("submit",()=>{if(event.preventDefault(),!sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");let e=new FormData,o=$("#itemName"),t=$("#itemDescription"),n=$("#itemPrice"),s=($("input[name=itemType]:checked").val(),$("input[name=itemCondition]:checked").val(),$("#itemImage"));const r=()=>{e.append("itemName",o.val()),e.append("itemDescription",t.val()),e.append("itemPrice",n.val()),e.append("itemType",$("input[name=itemType]:checked").val()),e.append("itemCondition",$("input[name=itemCondition]:checked").val()),e.append("itemImg",s[0].files[0]),e.append("userID",sessionStorage.userID),$.ajax({url:`${url}/addItem`,type:"POST",data:e,contentType:!1,processData:!1,success:function(e){clearForms(),$("#itemImageLabel").html("Upload image"),showItems()},error:function(o){console.log(e),console.log(o),console.log("How embarrassing, a database error! This never usually happens to me.")}})};if(0!=o.val().length&&0!=t.val().length&&0!=n.val().length&&void 0!=s[0].files[0]){if("image/jpg"===s[0].files[0].type)return void r();if("image/jpeg"===s[0].files[0].type)return void r();if("image/png"===s[0].files[0].type)return void r();if("image/gif"===s[0].files[0].type)return void r();alert("Sorry, but the server can't handle this kind of file. Try JPG, JPEG, PNG or GIF.")}else alert("Please add all of the item details!")}),$("#itemImage").change(()=>{const e=$("#itemImage")[0].files[0].name;$("#itemImageLabel").html(e)}),$("#cardContainer").on("click",".editBtn",function(){if(event.preventDefault(),!sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");const e=$(this).parent().parent().parent().data("id");$("#editModal").modal("show"),$.ajax({url:`${url}/getItem/${e}`,type:"GET",success:function(e){console.log(e),$("#itemNameEdit").val(e.item_name),$("#itemDescriptionEdit").val(e.item_description),$("#itemPriceEdit").val(e.price),$("#itemIDEdit").val(e._id)},error:function(e){console.log(e),console.log("How embarrassing, a database error! This never usually happens to me.")}})}),$("#editItemForm").submit(()=>{if(event.preventDefault(),!sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");let e=$("#itemIDEdit").val(),o=$("#itemNameEdit").val(),t=$("#itemDescriptionEdit").val(),n=$("#itemPriceEdit").val(),s=$("input[name=itemTypeEdit]:checked").val(),r=$("input[name=itemConditionEdit]:checked").val();0!=o.length&&0!=t.length&&0!=n.length?$.ajax({url:`${url}/editItem/${e}`,type:"PATCH",data:{itemName:o,itemDescription:t,itemPrice:n,itemCondition:r,itemType:s,userId:sessionStorage.userID},success:function(e){console.log(e),$("#editModal").modal("hide"),showItems()},error:function(e){console.log(e),console.log("How embarrassing, a database error! This never usually happens to me.")}}):alert("Please make sure you've put something in all of the fields!")}),$("#cardContainer").on("click",".removeBtn",function(){if(event.preventDefault(),!sessionStorage.userID)return void alert("401, permission denied");const e=$(this).parent().parent().parent().data("id"),o=$(this).parent().parent().parent();$.ajax({url:`${url}/deleteItem/${e}`,type:"DELETE",data:{userID:sessionStorage.userID},success:function(e){"401"==e?alert("401 error: you don't have permission to be here. Sorry. We don't make the rules."):(o.remove(),showItems())},error:function(e){console.log(e),console.log("something went wrong deleting the product")}})}),$("#cardContainer").on("click",".moreInfoBtn",function(){const e=$(this).parent().parent().parent().data("id");$.ajax({url:`${url}/getItem/${e}`,type:"GET",success:function(e){console.log(e),$("#singleItemModalTitle").empty(),$("#singleItemModalTitle").append(e.item_name),$("#singleItemModalBody").empty(),$("#singleItemModalBody").append(`<img class="img-fluid" src="${url}/${e.image_URL}">`),$("#singleItemModalBody").append("<p>Clothing type: "+e.clothing_type+"</p>"),$("#singleItemModalBody").append("<p>Condition: "+e.condition+"</p>"),$("#singleItemModalBody").append("<p>Description: "+e.item_description+"</p>"),$("#singleItemModalBody").append("<p>Price: $"+e.price+"</p>")},error:function(e){console.log(e),console.log("something went wrong with getting the single item")}})}),$("#cardContainer").on("click",".buyBtn",function(){console.log("clicked");const e=$(this).parent().parent().parent().data("id");console.log(e),$.ajax({url:`${url}/buyItem/${e}`,type:"PATCH",success:function(){console.log("changing bought to true in backend"),showItems()},error:function(e){console.log(e),console.log("How embarassing, a database error! This never usually happens to me.")}})}),$("#titleBtn").click(()=>{clearForms(),$(".main").removeClass("d-none"),hideLoginForm(),hideRegisterForm()});